<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metapredict">
<title>Guide to preparing data for a gene expression meta-analysis • metapredict</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Guide to preparing data for a gene expression meta-analysis">
<meta property="og:description" content="metapredict">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metapredict</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/guide.html">Guide to preparing data for a gene expression meta-analysis</a>
    <a class="dropdown-item" href="../articles/prepare_example.html">Preparing to run a gene expression meta-analysis of lung cancer subtypes</a>
    <a class="dropdown-item" href="../articles/run_example.html">Running a gene expression meta-analysis of lung cancer subtypes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hugheylab/metapredict/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="guide_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Guide to preparing data for a gene expression meta-analysis</h1>
            
            <h4 data-toc-skip class="date">2022-05-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hugheylab/metapredict/blob/HEAD/vignettes/guide.Rmd" class="external-link"><code>vignettes/guide.Rmd</code></a></small>
      <div class="d-none name"><code>guide.Rmd</code></div>
    </div>

    
    
<p>This vignette describes how to prepare data and metadata for a gene expression meta-analysis according to the method of <a href="https://doi.org/10.1093/nar/gkv229" class="external-link">Hughey and Butte (2015)</a>.</p>
<div class="section level2">
<h2 id="find-relevant-datasets">Find relevant datasets<a class="anchor" aria-label="anchor" href="#find-relevant-datasets"></a>
</h2>
<p>The first step is to find microarray datasets relevant to what you’re interested in. Most datasets will be on NCBI GEO or ArrayExpress, but not all, so it’s a good idea to also search the literature.</p>
</div>
<div class="section level2">
<h2 id="create-the-table-of-study-metadata">Create the table of study metadata<a class="anchor" aria-label="anchor" href="#create-the-table-of-study-metadata"></a>
</h2>
<p>The study metadata should be a comma-delimited text file, with one row for each study and at least the following columns:</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="82%">
</colgroup>
<thead><tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>study</code></td>
<td align="left">Name of the study, which must be unique.</td>
</tr>
<tr class="even">
<td align="left"><code>studyDataType</code></td>
<td align="left">Indicates how the expression data is stored (see below for details).</td>
</tr>
<tr class="odd">
<td align="left"><code>platformInfo</code></td>
<td align="left">Microarray platform, used for mapping probes to genes (see below for details).</td>
</tr>
</tbody>
</table>
<p>There are currently five options for <code>studyDataType</code>:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="79%">
</colgroup>
<thead><tr class="header">
<th align="left"><code>studyDataType</code></th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>affy_geo</code></td>
<td align="left">Raw Affymetrix data from a GEO study.</td>
</tr>
<tr class="even">
<td align="left"><code>affy_custom</code></td>
<td align="left">Raw Affymetrix data from a non-GEO study (e.g., ArrayExpress).</td>
</tr>
<tr class="odd">
<td align="left"><code>affy_series_matrix</code></td>
<td align="left">Normalized, untransformed, probe-level Affymetrix data in a GEO series matrix file.</td>
</tr>
<tr class="even">
<td align="left"><code>series_matrix</code></td>
<td align="left">Normalized, log-transformed (or equivalent) data in a GEO series matrix file.</td>
</tr>
<tr class="odd">
<td align="left"><code>eset_rds</code></td>
<td align="left">Normalized, log-transformed (or equivalent) data, already mapped to Entrez Gene IDs, saved as an <code>ExpressionSet</code> in an RDS file.</td>
</tr>
</tbody>
</table>
<p>The options for <code>platformInfo</code> depend on the <code>studyDataType</code>:</p>
<table class="table">
<colgroup>
<col width="53%">
<col width="46%">
</colgroup>
<thead><tr class="header">
<th align="left"><code>studyDataType</code></th>
<th align="left"><code>platformInfo</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">
<code>affy_geo</code>, <code>affy_custom</code>, or <code>affy_series_matrix</code>
</td>
<td align="left">Name of corresponding BrainArray custom cdf</td>
</tr>
<tr class="even">
<td align="left"><code>series_matrix</code></td>
<td align="left">Corresponding GPL identifier</td>
</tr>
<tr class="odd">
<td align="left"><code>eset_rds</code></td>
<td align="left"><code>ready</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="download-the-gene-expression-data">Download the gene expression data<a class="anchor" aria-label="anchor" href="#download-the-gene-expression-data"></a>
</h2>
<p>The format of the gene expression data for each study should correspond to its <code>studyDataType</code>. All the folders and/or files with expression data should be in one parent folder.</p>
<table class="table">
<colgroup>
<col width="40%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th align="left"><code>studyDataType</code></th>
<th align="left">Format of expression data if name of study is <code>GSE98765</code>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">
<code>affy_geo</code> or <code>affy_custom</code>
</td>
<td align="left">Folder named <code>GSE98765</code> containing cel or cel.gz files.</td>
</tr>
<tr class="even">
<td align="left">
<code>affy_series_matrix</code> or <code>series_matrix</code>
</td>
<td align="left">File from GEO named <code>GSE98765_series_matrix.txt.gz</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>eset_rds</code></td>
<td align="left">RDS file named <code>GSE98765.rds</code> containing a Bioconductor <code>ExpressionSet</code>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="if-necessary-download-packages-and-files-for-mapping-affy-probe-sets-to-entrez-gene-ids">If necessary, download packages and files for mapping Affy probe sets to Entrez Gene IDs<a class="anchor" aria-label="anchor" href="#if-necessary-download-packages-and-files-for-mapping-affy-probe-sets-to-entrez-gene-ids"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p>For studies whose <code>studyDataType</code> is <code>affy_geo</code> or <code>affy_custom</code>, install the custom CDF package(s). See the <code>installCustomCdfPackages</code> documentation for details.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="fu">metapredict</span><span class="fu">::</span><span class="va"><a href="../reference/installCustomCdfPackages.html">installCustomCdfPackages</a></span></code></pre></div>
</li>
<li>
<p>For studies whose <code>studyDataType</code> is <code>affy_series_matrix</code>, download the custom CDF mapping(s). See the <code>downloadCustomCdfMappings</code> documentation for details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="fu">metapredict</span><span class="fu">::</span><span class="va"><a href="../reference/downloadCustomCdfMappings.html">downloadCustomCdfMappings</a></span></code></pre></div>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="check-that-all-studies-whose-studydatatype-series_matrix-are-supported">Check that all studies whose <code>studyDataType == 'series_matrix'</code> are supported<a class="anchor" aria-label="anchor" href="#check-that-all-studies-whose-studydatatype-series_matrix-are-supported"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p>Open R and execute the following commands, replacing “&lt;path to study metadata file&gt;” as appropriate.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">studyMetadata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">'&lt;path to study metadata file&gt;'</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu">metapredict</span><span class="fu">::</span><span class="fu"><a href="../reference/getUnsupportedPlatforms.html">getUnsupportedPlatforms</a></span><span class="op">(</span><span class="va">studyMetadata</span><span class="op">)</span></code></pre></div>
</li>
<li>
<p>If any platforms are not supported but you still want to include those studies in the meta-analysis, you will need to edit the source of the metapredict package.</p>
<ol style="list-style-type: decimal">
<li>In the <code><a href="../reference/getStudyData.html">getStudyData()</a></code> function, add another <code>else if</code> statement that tells the function how to map probes to Entrez Gene IDs for that platform. Look at the code for currently supported platforms to see examples of how this is done.</li>
<li>Add the GPL for the microarray platform to the character vector of supported platforms in the <code><a href="../reference/getSupportedPlatforms.html">getSupportedPlatforms()</a></code> function.</li>
<li>Submit a pull request to <a href="https://github.com/hugheylab/metapredict" class="external-link uri">https://github.com/hugheylab/metapredict</a>, so other people can analyze data from that platform without going through the same hassle!</li>
</ol>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="create-the-table-of-sample-metadata">Create the table of sample metadata<a class="anchor" aria-label="anchor" href="#create-the-table-of-sample-metadata"></a>
</h2>
<p>The sample metadata should be a comma-delimited text file, with one row for each sample and at least the following columns:</p>
<table class="table">
<colgroup>
<col width="40%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>study</code></td>
<td align="left">Name of the corresponding study.</td>
</tr>
<tr class="even">
<td align="left"><code>sample</code></td>
<td align="left">Name of the sample, which must be unique across all studies.</td>
</tr>
<tr class="odd">
<td align="left">
<code>outcome</code>, <code>class</code>, or something similar</td>
<td align="left">Variable that the meta-analysis will be trying to predict.</td>
</tr>
</tbody>
</table>
<p>The format of the sample names depends on the <code>studyDataType</code>:</p>
<table class="table">
<colgroup>
<col width="37%">
<col width="62%">
</colgroup>
<thead><tr class="header">
<th align="left"><code>studyDataType</code></th>
<th align="left">Format of sample names</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">
<code>affy_geo</code> or <code>affy_custom</code>
</td>
<td align="left">Names of the .cel or .cel.gz files (excluding the file extension).</td>
</tr>
<tr class="even">
<td align="left">
<code>affy_series_matrix</code> or <code>series_matrix</code>
</td>
<td align="left">Names of the GSM identifiers from the series matrix file.</td>
</tr>
<tr class="odd">
<td align="left"><code>eset_rds</code></td>
<td align="left">colnames of the expression matrix in the <code>ExpressionSet</code>.</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jake Hughey, Josh Schoenbachler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
